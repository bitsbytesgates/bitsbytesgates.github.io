---
layout: legacy_post
title: 'FWRISC: Designing an FPGA-friendly Core in 30 Days'
date: '2018-12-01T17:55:00.000-08:00'
author: Matthew Ballance
tags:
- Zephyr
- Verilator
- RTL
- FPGA
- Googletest
- Verilog
- RISCVcontest
- RISC-V
- HDL
modified_time: '2018-12-04T12:56:24.325-08:00'
thumbnail: https://3.bp.blogspot.com/-rCh9bdAbtkY/XAL5Um0aZOI/AAAAAAAACaI/RH1k9rBNkwM2bhGswKIO1Q63wTv6NraVQCLcBGAs/s72-c/fwrisc_intro_splash_2.png
blogger_id: tag:blogger.com,1999:blog-142675602739945566.post-3278562873094967676
blogger_orig_url: https://bitsbytesgates.blogspot.com/2018/12/risc-v-designing-fpga-friendly-core-in.html
---

<div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="https://3.bp.blogspot.com/-rCh9bdAbtkY/XAL5Um0aZOI/AAAAAAAACaI/RH1k9rBNkwM2bhGswKIO1Q63wTv6NraVQCLcBGAs/s1600/fwrisc_intro_splash_2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="300" data-original-width="540" src="https://3.bp.blogspot.com/-rCh9bdAbtkY/XAL5Um0aZOI/AAAAAAAACaI/RH1k9rBNkwM2bhGswKIO1Q63wTv6NraVQCLcBGAs/s1600/fwrisc_intro_splash_2.png" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">Designing a processor is often considered to be a large and complex undertaking, so how did I decide to design and implement in a month? For a few reasons, really. For one, my background is in hardware design, despite having worked in the EDA (Electronic Design Automation) software industry for many years. The last time I did a full hardware design was quite a few years ago using an i386EX embedded processor and other packaged ICs. Recently, though, I've been looking for opportunities to brush up on my digital-design skills. The primary reason, however, was that I saw the call for contestants in the <a href="https://riscv.org/2018contest/">2018 RISC-V soft-core processor contest</a>. I've found contests to be a fun way to learn because the organizers' criteria often cause me to learn something I otherwise wouldn't have thought to investigate. This contest was certainly no different!</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">The 2018 RISC-V contest certainly had some unique criteria. The contest required that verification be done using the <a href="https://www.veripool.org/wiki/verilator">Verilator</a>&nbsp;"simulator", an open-source Verilog to C++ translator that is very fast and powerful, but also has some interesting quirks. Also required was support for <a href="https://www.zephyrproject.org/">Zephyr</a>, a real-time operating system (RTOS) that I certainly wasn't aware of before the contest. Most interesting to me, though, was the contest category for smallest RISC-V FPGA implementation.</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><b>Small, you say?</b></div><div class="separator" style="clear: both; text-align: left;">When thinking about processor design, I often think about maximizing performance. However, there are many applications -- especially in the IoT space -- where having a small amount of processing power that requires little resources is very important. Often these applications are dominated today by older processor architectures, such as the venerable 8051. Despite it's somewhat-small size in an FPGA implementation, the 8051 processor isn't terribly friendly to C compilers, and is very slow. What if a modern architecture, such as the RISC-V ISA, could take the place of these older architectures while matching, or even improving, on their small size?</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;">Despite seeing the value of having small RISC-V implementations, my first reaction when seeing the contest announcement was puzzlement. Weren't there already several small RISC-V implementations? Well, as it turns out, yes and no. There were several existing small implementations. However, the ones I found were not truly compliant with the RV32I architecture specification. The tradeoffs taken were often taken to reduce the implementation size by removing features that required resources, but were not needed for the author's intended application. These tradeoffs often meant that a special compiler toolchain was needed, or that users needed to be cautious when attempting to reuse existing software written for the RISC-V ISA.</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: left;"><b>Results?</b></div><div class="separator" style="clear: both; text-align: left;">Well, bottom line, I was able to design, verify, and implement a 32-bit RV32I RISC-V core in 30 days, and you can find the code on <a href="https://github.com/mballance/fwrisc">GitHub</a>. A netlist of the design is shown at the beginning of this post. Early results are quite promising with respect to the balance between performance and size, and there are several known areas for improvement. Through the process, I've learned a lot -- rediscovering RTL design, gaining a much deeper appreciation of the RISC-V ISA, and learning about new tools like Verilator and infrastructure like Zephyr. Over the next few weeks, I'll be writing more about specific details of the design and verification process and what I learned. So, stay tuned for future posts!</div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both;"><b><i>Disclaimer</i></b></div><div class="separator" style="clear: both;"><i>The views and opinions expressed above are solely those of the author and do not represent those of my employer or any other party.</i></div><div><i><br /></i></div>