---
layout: legacy_post
title: Generate Custom Content Quickly with a Template Engine
date: '2019-03-02T13:38:00.001-08:00'
author: Matthew Ballance
tags:
- Automation
- Jinja2
- Template
- Verification
- Python
- SystemVerilog
modified_time: '2019-03-02T13:38:42.442-08:00'
thumbnail: https://1.bp.blogspot.com/-ATyX_mYeEFY/XHrrYRSDP7I/AAAAAAAAChQ/6yYSRbhzfPABx-p8zJmIID_4v3K9KArywCLcBGAs/s72-c/vte-splash.png
blogger_id: tag:blogger.com,1999:blog-142675602739945566.post-1242043696191857470
blogger_orig_url: https://bitsbytesgates.blogspot.com/2019/03/generate-custom-content-quickly-with.html
---

<br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-ATyX_mYeEFY/XHrrYRSDP7I/AAAAAAAAChQ/6yYSRbhzfPABx-p8zJmIID_4v3K9KArywCLcBGAs/s1600/vte-splash.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="330" data-original-width="495" src="https://1.bp.blogspot.com/-ATyX_mYeEFY/XHrrYRSDP7I/AAAAAAAAChQ/6yYSRbhzfPABx-p8zJmIID_4v3K9KArywCLcBGAs/s1600/vte-splash.png" /></a></div><br />I was at <a href="https://dvcon.org/">DVCon</a> earlier this week, and attended the UVM Update Tutorial delivered by Cliff Cummings. Cliff described his typical process of creating UVM elements, which is to have a set of 'golden' template files that can be copied and hand-customized to the task at hand. It's certainly something I've done frequently on UVM projects and in many other contexts as well.<br /><br />If you work in verification and you're anything like me, you create lots of files pretty much every day. Scripts, UVM code, C++ code, Makefiles, meta-data files, the list goes on and on. While all of these files will contain custom content, there is often a lot of boilerplate content as well. There are certainly specialized tools focused on quickly creating content for specific domains. For example, there are several tools and libraries to help quickly create UVM elements based on some high-level inputs from the user. But, what about files that are custom to your environment? Can we do better than the standard process of copy, rename, and then manually doing a search/replace in each file?<br /><br /><b>VTE</b><br />I've recently been playing with just such a template engine for my own use. For lack of a better name, I've been calling it the Verification Template Engine (VTE), since I'm largely using it for creating files in the context of a verification environment. VTE is implemented in Python and leverages the <a href="http://jinja.pocoo.org/docs/2.10/">Jinja2</a> template engine, which is typically used for creating web content from a template.<br /><br />Given how much VTE is just reusing existing functionality, what is the value-add? Two things, really:<br /><br /><ul><li>VTE provides a user interface that makes it easy to see what templates are available in the environment</li><li>VTE specifies a template structure that makes it really easy to create new templates from those 'golden' template files that you would normally copy, rename, and modify.</li></ul><br /><b>Using Templates</b><br />VTE currently ships a couple of small templates with the tool. Your custom templates will be found via the VTE_TEMPLATE_PATH environment variable.<br /><br />VTE currently supports two commands: <i>list</i>&nbsp;and <i>generate. </i>The <i>list</i>&nbsp;command shows the set of templates that were found on the template path.<br /><i><br /></i><pre style="background-color: #f6f8fa; border-radius: 3px; box-sizing: border-box; color: #24292e; font-family: SFMono-Regular, Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 13.6px; line-height: 1.45; margin-bottom: 16px; overflow-wrap: normal; overflow: auto; padding: 16px;"><code style="background: transparent; border-radius: 3px; border: 0px; box-sizing: border-box; display: inline; font-family: SFMono-Regular, Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 13.6px; line-height: inherit; margin: 0px; overflow-wrap: normal; overflow: visible; padding: 0px; word-break: normal;">% vte list<br />project.ivpm.googletest-hdl - IVPM project with Googletest-HDL dependence<br />verif.ip.googletest-hdl     - IP verification environment using Googletest-HDL<br />verif.uvm.test              - Creates a UVM test class<br /></code></pre><div><code style="background: transparent; border-radius: 3px; border: 0px; box-sizing: border-box; display: inline; font-family: SFMono-Regular, Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 13.6px; line-height: inherit; margin: 0px; overflow-wrap: normal; overflow: visible; padding: 0px; word-break: normal;"><span style="font-family: &quot;Times New Roman&quot;; font-size: small;">The generate command, as you might expect, generates content from a specified template.&nbsp;</span></code></div><div><br /></div><div><pre style="background-color: #f6f8fa; border-radius: 3px; box-sizing: border-box; color: #24292e; font-family: SFMono-Regular, Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 13.6px; line-height: 1.45; margin-bottom: 16px; overflow-wrap: normal; overflow: auto; padding: 16px;"><code style="background: transparent; border-radius: 3px; border: 0px; box-sizing: border-box; display: inline; font-family: SFMono-Regular, Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 13.6px; line-height: inherit; margin: 0px; overflow-wrap: normal; overflow: visible; padding: 0px; word-break: normal;">usage: vte generate [-h] [-force] template name [KEY=VALUE [KEY=VALUE ...]]<br /><br />positional arguments:<br />  template    ID of template<br />  name        Name to use in the template<br />  KEY=VALUE   Specify other template variables<br /><br />optional arguments:<br />  -h, --help  show this help message and exit<br />  -force      force overwrite of existing files</code></pre></div><div><br /></div><div>Here's an example using VTE to create the skeleton project structure that I use when developing an IP:</div><div><br /></div><div><pre style="background-color: #f6f8fa; border-radius: 3px; box-sizing: border-box; color: #24292e; font-family: SFMono-Regular, Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 13.6px; line-height: 1.45; margin-bottom: 16px; overflow-wrap: normal; overflow: auto; padding: 16px;"><code style="background: transparent; border-radius: 3px; border: 0px; box-sizing: border-box; display: inline; font-family: SFMono-Regular, Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 13.6px; line-height: inherit; margin: 0px; overflow-wrap: normal; overflow: visible; padding: 0px; word-break: normal;">% vte generate project.ivpm.googletest-hdl my_proj<br />Note: processing template etc/ivpm.info<br />Note: processing template etc/packages.mf<br />Note: processing template etc/env.sh<br />Note: processing template scripts/ivpm.py<br />Note: processing template scripts/ivpm.mk<br />% find -type f<br />./etc/ivpm.info<br />./etc/packages.mf<br />./etc/my_proj_env.sh<br />./scripts/ivpm.py<br />./scripts/ivpm.mk</code></pre></div><b>Creating Templates</b><br /><br />Creating new template is simple as well. VTE. uses a marker file, named <i>.vte</i>&nbsp;to identify the root directory of a template. Any files in that directory or its subdirectories is considered to be a template file. The ID for a template is composed from the path elements between the VTE_TEMPLATE_PATH entry and the directory containing the <i>.vte</i>&nbsp;marker file.<br /><br />For a very simple template, all you need is an empty <i>.vte</i>&nbsp;marker. However, adding a little information to the <i>.vte</i>&nbsp;file makes your template more useful. For example, you can add a short description for your template, which will be shown with the <i>vte list </i>command is run:<br /><br /><pre style="background-color: #f6f8fa; border-radius: 3px; box-sizing: border-box; color: #24292e; font-family: SFMono-Regular, Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 13.6px; line-height: 1.45; margin-bottom: 16px; overflow-wrap: normal; overflow: auto; padding: 16px;"><code style="background: transparent; border-radius: 3px; border: 0px; box-sizing: border-box; display: inline; font-family: SFMono-Regular, Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 13.6px; line-height: inherit; margin: 0px; overflow-wrap: normal; overflow: visible; padding: 0px; word-break: normal;">[template]<br />desc = Creates a UVM test class</code></pre><br />The template files, themselves, use <a href="http://jinja.pocoo.org/docs/2.10/">Jinja2</a> markup to refer to template parameters and specify directives.<br /><br /><pre style="background-color: #f6f8fa; border-radius: 3px; box-sizing: border-box; color: #24292e; font-family: SFMono-Regular, Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 13.6px; line-height: 1.45; margin-bottom: 16px; overflow-wrap: normal; overflow: auto; padding: 16px;"><code style="background: transparent; border-radius: 3px; border: 0px; box-sizing: border-box; display: inline; font-family: SFMono-Regular, Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 13.6px; line-height: inherit; margin: 0px; overflow-wrap: normal; overflow: visible; padding: 0px; word-break: normal;">/****************************************************************************<br /> * {{ "{{" }}name}}.svh<br /> * <br /> ****************************************************************************/<br />{{ "{%" }}set filename = "{{ "{{" }}name}}.svh" %}<br />/**<br /> * Class: {{ "{{" }}name}}<br /> * TODO: Document UVM Test {{ "{{" }}name}}<br /> */<br />class {{ "{{" }}name}} extends {{ "{{" }}base_class}};<br /> `uvm_component_utils({{ "{{" }}name}})<br /> <br /> function new(string name, uvm_component parent=null);<br />  super.new(name, parent);<br /> endfunction<br /> <br />endclass<br /></code></pre><div><code style="background: transparent; border-radius: 3px; border: 0px; box-sizing: border-box; display: inline; font-family: SFMono-Regular, Consolas, &quot;Liberation Mono&quot;, Menlo, Courier, monospace; font-size: 13.6px; line-height: inherit; margin: 0px; overflow-wrap: normal; overflow: visible; padding: 0px; word-break: normal;"><br /></code></div>The example above is a template for a UVM Test class. The <i>{{ "{%" }} set filename ... %}</i>&nbsp;directive specifies the name of the output file, which depends on the value of the <i>name</i>&nbsp;parameter. The rest of the template contains a reference to the <i>name</i>&nbsp;parameter wherever we want that to be substituted in. As you can probably guess, these locations where <i>{{ "{{" }}name}}</i>&nbsp;is referenced are the very locations that you'd go through with a text editor and manually substitute in some content.<br /><br /><br /><b>Sound Interesting?</b><br />If this all sounds interesting, check out VTE on GitHub:&nbsp;<a href="https://github.com/fvutils/vte">https://github.com/fvutils/vte</a>. You can download a release tarball from the <i>Releases</i>&nbsp;area, add the bin directory to your PATH, and try it out right away. You can also find documentation in the <a href="https://github.com/fvutils/vte/blob/master/README.md">README</a> file.<br />If you find an issue with VTE, or would like to see it support a new feature, file a ticket on the GitHub issue tracker. Even better, send me a pull request!<br /><br />My hope is that a tool like VTE can make creating boilerplate code much simpler and faster, allowing you to focus your efforts on adding truly-unique content. That is, after all, always the goal of engineering and automation, right?<br /><br /><br /><br />